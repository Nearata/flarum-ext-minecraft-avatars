{"version":3,"file":"forum.js","mappings":"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","sources":["webpack://@nearata/flarum-ext-minecraft-avatars/webpack/bootstrap","webpack://@nearata/flarum-ext-minecraft-avatars/webpack/runtime/compat get default export","webpack://@nearata/flarum-ext-minecraft-avatars/webpack/runtime/define property getters","webpack://@nearata/flarum-ext-minecraft-avatars/webpack/runtime/hasOwnProperty shorthand","webpack://@nearata/flarum-ext-minecraft-avatars/webpack/runtime/make namespace object","webpack://@nearata/flarum-ext-minecraft-avatars/external root \"flarum.core.compat['common/extend']\"","webpack://@nearata/flarum-ext-minecraft-avatars/external root \"flarum.core.compat['forum/app']\"","webpack://@nearata/flarum-ext-minecraft-avatars/external root \"flarum.core.compat['common/components/Button']\"","webpack://@nearata/flarum-ext-minecraft-avatars/external root \"flarum.core.compat['common/models/User']\"","webpack://@nearata/flarum-ext-minecraft-avatars/external root \"flarum.core.compat['forum/components/AvatarEditor']\"","webpack://@nearata/flarum-ext-minecraft-avatars/./node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","webpack://@nearata/flarum-ext-minecraft-avatars/external root \"flarum.core.compat['common/components/Modal']\"","webpack://@nearata/flarum-ext-minecraft-avatars/./src/forum/components/ChangeMinotarModal.js","webpack://@nearata/flarum-ext-minecraft-avatars/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@nearata/flarum-ext-minecraft-avatars/./src/forum/index.ts"],"sourcesContent":["// The require scope\nvar __webpack_require__ = {};\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => (module['default']) :\n\t\t() => (module);\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/extend'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/app'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Button'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/models/User'];","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['forum/components/AvatarEditor'];","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf ? Object.setPrototypeOf.bind() : function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n  return _setPrototypeOf(o, p);\n}","const __WEBPACK_NAMESPACE_OBJECT__ = flarum.core.compat['common/components/Modal'];","import app from \"flarum/forum/app\";\nimport Button from \"flarum/common/components/Button\";\nimport Modal from \"flarum/common/components/Modal\";\n\nexport default class ChangeMinotarModal extends Modal {\n    oninit(vnode) {\n        super.oninit(vnode);\n\n        this.user = this.attrs.user;\n\n        this.success = false;\n        this.minotar = this.user.attribute(\"minotar\");\n    }\n\n    className() {\n        return \"NearataMinecraftAvatarsModal Modal--small\";\n    }\n\n    title() {\n        return app.translator.trans(\"nearata-minecraft-avatars.forum.title\");\n    }\n\n    content() {\n        return [\n            m(\".Modal-body\", [\n                m(\".Form.Form--centered\", [\n                    this.success\n                        ? [\n                              m(\n                                  \"p.helpText\",\n                                  app.translator.trans(\n                                      \"nearata-minecraft-avatars.forum.avatar_changed\"\n                                  )\n                              ),\n                              m(\".Form-group\", [\n                                  m(\n                                      Button,\n                                      {\n                                          class: \"Button Button--primary Button--block\",\n                                          onclick: this.hide.bind(this),\n                                      },\n                                      app.translator.trans(\n                                          \"nearata-minecraft-avatars.forum.dismiss_button\"\n                                      )\n                                  ),\n                              ]),\n                          ]\n                        : [\n                              m(\n                                  \"p.helpText\",\n                                  app.translator.trans(\n                                      \"nearata-minecraft-avatars.forum.help_text\"\n                                  )\n                              ),\n                              m(\".Form-group\", [\n                                  m(\"input\", {\n                                      type: \"name\",\n                                      name: \"minotar\",\n                                      class: \"FormControl\",\n                                      placeholder: app.translator.trans(\n                                          \"nearata-minecraft-avatars.forum.placeholder\"\n                                      ),\n                                      oninput: (e) =>\n                                          (this.minotar = e.target.value),\n                                      disabled: this.loading,\n                                      autocomplete: \"off\",\n                                  }),\n                              ]),\n                              m(\".Form-group\", [\n                                  m(\n                                      Button,\n                                      {\n                                          class: \"Button Button--primary Button--block\",\n                                          type: \"submit\",\n                                          loading: this.loading,\n                                      },\n                                      app.translator.trans(\n                                          \"nearata-minecraft-avatars.forum.submit_button\"\n                                      )\n                                  ),\n                              ]),\n                          ],\n                ]),\n            ]),\n            m(\".Modal-footer\", [\n                m(\"span\", [\n                    \"Powered by \",\n                    m(\n                        \"a\",\n                        {\n                            href: \"https://crafatar.com/\",\n                            target: \"_blank\",\n                        },\n                        \"Crafatar\"\n                    ),\n                ]),\n            ]),\n        ];\n    }\n\n    onsubmit(e) {\n        e.preventDefault();\n\n        if (this.minotar === this.user.attribute(\"minotar\")) {\n            this.hide();\n            return;\n        }\n\n        this.loading = true;\n        this.alertAttrs = null;\n\n        this.user\n            .save(\n                {\n                    minotar: this.minotar,\n                },\n                {\n                    errorHandler: this.onerror.bind(this),\n                    meta: { minotar: this.minotar },\n                }\n            )\n            .then(() => (this.success = true))\n            .catch(() => {})\n            .then(this.loaded.bind(this));\n    }\n\n    loaded() {\n        delete this.user.avatarColor;\n\n        super.loaded();\n    }\n}\n","import setPrototypeOf from \"./setPrototypeOf.js\";\nexport default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  setPrototypeOf(subClass, superClass);\n}","import { extend } from \"flarum/common/extend\";\nimport app from \"flarum/forum/app\";\nimport Button from \"flarum/common/components/Button\";\nimport User from \"flarum/common/models/User\";\nimport AvatarEditor from \"flarum/forum/components/AvatarEditor\";\n\nimport ChangeMinotarModal from \"./components/ChangeMinotarModal\";\n\napp.initializers.add(\"nearata-minecraft-avatars\", () => {\n    const baseUrl = \"https://crafatar.com\";\n    const defaults = new Set([\"MHF_Steve\", \"MHF_Alex\"]);\n    const nilUuid = \"00000000-0000-0000-0000-000000000000\";\n    const validate =\n        /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{8}[0-9a-f]{4}[1-5][0-9a-f]{3}[89ab][0-9a-f]{3}[0-9a-f]{12})$/i;\n\n    User.prototype.avatarUrl = function () {\n        let minotar: string | null = this.attribute(\"minotar\");\n        const avatar: string | null = this.attribute(\"avatarUrl\");\n\n        if (!minotar || avatar) {\n            return avatar;\n        }\n\n        const avatarUrl = new URL(baseUrl + \"/avatars/\");\n\n        avatarUrl.searchParams.append(\"size\", \"64\");\n\n        if (!validate.test(minotar)) {\n            if (defaults.has(minotar)) {\n                avatarUrl.searchParams.append(\"default\", minotar);\n            } else {\n                avatarUrl.searchParams.append(\"default\", \"MHF_Steve\");\n            }\n\n            minotar = nilUuid;\n        }\n\n        avatarUrl.pathname += minotar;\n\n        return avatarUrl.toString();\n    };\n\n    extend(AvatarEditor.prototype, \"controlItems\", function (items) {\n        const minotar: string | null = this.attrs.user.attribute(\"minotar\");\n        const changeButton = app.translator.trans(\n            \"nearata-minecraft-avatars.forum.change_button\"\n        );\n        const useButton = app.translator.trans(\n            \"nearata-minecraft-avatars.forum.use_button\"\n        );\n\n        items.add(\n            \"nearataMinecraftAvatars\",\n            m(\n                Button,\n                {\n                    icon: \"fas fa-cloud-upload-alt\",\n                    onclick: () =>\n                        app.modal.show(ChangeMinotarModal, {\n                            user: this.attrs.user,\n                        }),\n                },\n                minotar ? changeButton : useButton\n            ),\n            1\n        );\n\n        const avatarUrl = this.attrs.user.avatarUrl();\n\n        if (avatarUrl === null) {\n            return;\n        }\n\n        const url = new URL(avatarUrl);\n\n        if (url.searchParams.has(\"default\")) {\n            items.remove(\"remove\");\n        }\n    });\n\n    extend(AvatarEditor.prototype, \"remove\", function () {\n        const minotar: string | null = this.attrs.user.attribute(\"minotar\");\n\n        if (this.attrs.user.attribute(\"avatarUrl\") != null) {\n            return;\n        }\n\n        if (minotar === null) {\n            return;\n        }\n\n        if (defaults.has(minotar)) {\n            return;\n        }\n\n        this.attrs.user\n            .save({\n                minotar: \"\",\n            })\n            // @ts-ignore\n            .then(this.success.bind(this), this.failure.bind(this));\n    });\n});\n"],"names":["__webpack_require__","module","getter","__esModule","d","a","exports","definition","key","o","Object","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","call","Symbol","toStringTag","value","flarum","core","compat","_setPrototypeOf","p","setPrototypeOf","bind","__proto__","ChangeMinotarModal","subClass","superClass","create","constructor","oninit","vnode","this","user","attrs","success","minotar","attribute","className","title","app","content","m","Button","class","onclick","hide","type","name","placeholder","oninput","e","target","disabled","loading","autocomplete","href","onsubmit","preventDefault","alertAttrs","save","errorHandler","onerror","meta","then","loaded","avatarColor","Modal","defaults","Set","validate","User","avatar","avatarUrl","URL","baseUrl","searchParams","append","test","has","pathname","toString","extend","AvatarEditor","items","changeButton","useButton","add","icon","remove","failure"],"sourceRoot":""}