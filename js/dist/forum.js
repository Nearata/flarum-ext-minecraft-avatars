(()=>{var t={n:a=>{var r=a&&a.__esModule?()=>a.default:()=>a;return t.d(r,{a:r}),r},d:(a,r)=>{for(var e in r)t.o(r,e)&&!t.o(a,e)&&Object.defineProperty(a,e,{enumerable:!0,get:r[e]})},o:(t,a)=>Object.prototype.hasOwnProperty.call(t,a),r:t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}},a={};(()=>{"use strict";t.r(a);const r=flarum.core.compat["common/extend"],e=flarum.core.compat["forum/app"];var o=t.n(e);const n=flarum.core.compat["common/components/Button"];var s=t.n(n);const i=flarum.core.compat["common/models/User"];var u=t.n(i);const c=flarum.core.compat["forum/components/AvatarEditor"];var l=t.n(c);function f(t,a){return f=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,a){return t.__proto__=a,t},f(t,a)}const p=flarum.core.compat["common/components/Modal"];var h=function(t){var a,r;function e(){return t.apply(this,arguments)||this}r=t,(a=e).prototype=Object.create(r.prototype),a.prototype.constructor=a,f(a,r);var n=e.prototype;return n.oninit=function(a){t.prototype.oninit.call(this,a),this.user=this.attrs.user,this.success=!1,this.minotar=this.user.attribute("minotar")},n.className=function(){return"NearataMinecraftAvatarsModal Modal--small"},n.title=function(){return o().translator.trans("nearata-minecraft-avatars.forum.title")},n.content=function(){var t=this;return[m(".Modal-body",[m(".Form.Form--centered",[this.success?[m("p.helpText",o().translator.trans("nearata-minecraft-avatars.forum.avatar_changed")),m(".Form-group",[m(s(),{class:"Button Button--primary Button--block",onclick:this.hide.bind(this)},o().translator.trans("nearata-minecraft-avatars.forum.dismiss_button"))])]:[m("p.helpText",o().translator.trans("nearata-minecraft-avatars.forum.help_text")),m(".Form-group",[m("input",{type:"name",name:"minotar",class:"FormControl",placeholder:o().translator.trans("nearata-minecraft-avatars.forum.placeholder"),oninput:function(a){return t.minotar=a.target.value},disabled:this.loading,autocomplete:"off"})]),m(".Form-group",[m(s(),{class:"Button Button--primary Button--block",type:"submit",loading:this.loading},o().translator.trans("nearata-minecraft-avatars.forum.submit_button"))])]])]),m(".Modal-footer",[m("span",["Powered by ",m("a",{href:"https://crafatar.com/",target:"_blank"},"Crafatar")])])]},n.onsubmit=function(t){var a=this;t.preventDefault(),this.minotar!==this.user.attribute("minotar")?(this.loading=!0,this.alertAttrs=null,this.user.save({minotar:this.minotar},{errorHandler:this.onerror.bind(this),meta:{minotar:this.minotar}}).then((function(){return a.success=!0})).catch((function(){})).then(this.loaded.bind(this))):this.hide()},n.loaded=function(){delete this.user.avatarColor,t.prototype.loaded.call(this)},e}(t.n(p)());o().initializers.add("nearata-minecraft-avatars",(function(){var t=new Set(["MHF_Steve","MHF_Alex"]),a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|[0-9a-f]{8}[0-9a-f]{4}[1-5][0-9a-f]{3}[89ab][0-9a-f]{3}[0-9a-f]{12})$/i;u().prototype.avatarUrl=function(){var r=this.attribute("minotar"),e=this.attribute("avatarUrl");if(!r||e)return e;var o=new URL("https://crafatar.com/avatars/");return o.searchParams.append("size","64"),a.test(r)||(t.has(r)?o.searchParams.append("default",r):o.searchParams.append("default","MHF_Steve"),r="00000000-0000-0000-0000-000000000000"),o.pathname+=r,o.toString()},(0,r.extend)(l().prototype,"controlItems",(function(t){var a=this,r=this.attrs.user.attribute("minotar"),e=o().translator.trans("nearata-minecraft-avatars.forum.change_button"),n=o().translator.trans("nearata-minecraft-avatars.forum.use_button");t.add("nearataMinecraftAvatars",m(s(),{icon:"fas fa-cloud-upload-alt",onclick:function(){return o().modal.show(h,{user:a.attrs.user})}},r?e:n),1);var i=this.attrs.user.avatarUrl();null!==i&&new URL(i).searchParams.has("default")&&t.remove("remove")})),(0,r.extend)(l().prototype,"remove",(function(){var a=this.attrs.user.attribute("minotar");null==this.attrs.user.attribute("avatarUrl")&&null!==a&&(t.has(a)||this.attrs.user.save({minotar:""}).then(this.success.bind(this),this.failure.bind(this)))}))}))})(),module.exports=a})();
//# sourceMappingURL=forum.js.map